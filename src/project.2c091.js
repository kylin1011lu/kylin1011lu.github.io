window.__require=function t(e,o,n){function i(c,s){if(!o[c]){if(!e[c]){var p=c.split("/");if(p=p[p.length-1],!e[p]){var a="function"==typeof __require&&__require;if(!s&&a)return a(p,!0);if(r)return r(p,!0);throw new Error("Cannot find module '"+c+"'")}c=p}var u=o[c]={exports:{}};e[c][0].call(u.exports,function(t){return i(e[c][1][t]||t)},u,u.exports,t,e,o,n)}return o[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<n.length;c++)i(n[c]);return i}({AudioMgr:[function(t,e,o){"use strict";cc._RF.push(e,"56ac2xtAdxJypIqDm+RvIPJ","AudioMgr");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var r=t("./InstanceMgr"),c=cc._decorator,s=c.ccclass,p=c.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bg=null,e.singleOpenClip=null,e.moreOpenClip=null,e.flagClip=null,e.bombClip=null,e.commboClips=[],e}return n(e,t),e.prototype.onLoad=function(){r.InstanceMgr.registerInstance("AudioMgr",this)},e.prototype.playSingleOpen=function(){cc.audioEngine.play(this.singleOpenClip,!1,1)},e.prototype.playMoreOpen=function(){cc.audioEngine.play(this.moreOpenClip,!1,1)},e.prototype.playFlag=function(){cc.audioEngine.play(this.flagClip,!1,1)},e.prototype.playBomb=function(){cc.audioEngine.play(this.bombClip,!1,1)},e.prototype.playCombo=function(t){t<1&&(t=1),t>10&&(t=10),cc.audioEngine.play(this.commboClips[t-1],!1,1)},i([p({type:cc.AudioSource,tooltip:"\u80cc\u666f\u97f3\u4e50"})],e.prototype,"bg",void 0),i([p({type:cc.AudioClip,tooltip:"\u5355\u5f00\u65b9\u5757"})],e.prototype,"singleOpenClip",void 0),i([p({type:cc.AudioClip,tooltip:"\u591a\u5f00\u65b9\u5757"})],e.prototype,"moreOpenClip",void 0),i([p({type:cc.AudioClip,tooltip:"\u6807\u8bb0"})],e.prototype,"flagClip",void 0),i([p({type:cc.AudioClip,tooltip:"\u70b8\u96f7"})],e.prototype,"bombClip",void 0),i([p({type:[cc.AudioClip],tooltip:"\u8fde\u51fb"})],e.prototype,"commboClips",void 0),e=i([s],e)}(cc.Component);o.default=a,cc._RF.pop()},{"./InstanceMgr":"InstanceMgr"}],Block:[function(t,e,o){"use strict";cc._RF.push(e,"851b3hdMfRHL5kOFviMf0jg","Block");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var r=t("./EnumDefine"),c=t("./InstanceMgr"),s=cc._decorator,p=s.ccclass,a=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.defaultFrame=null,e.nums=[],e.mines=[],e.flagFrame=null,e.blockType=r.BlockType.NUMBER,e.pos=new cc.Vec2(0,0),e._number=0,e._isOpen=!1,e._isFlag=!1,e}return n(e,t),Object.defineProperty(e.prototype,"isMine",{get:function(){return this.blockType==r.BlockType.MINE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"number",{get:function(){return this._number},set:function(t){t<0||t>8?cc.error("Block num out of range, num is "+t):this._number=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.blockType==r.BlockType.NUMBER&&0==this._number},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOpen",{get:function(){return this._isOpen},set:function(t){this._isOpen=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFlag",{get:function(){return this._isFlag},set:function(t){this._isFlag=t,this.sprite.spriteFrame=1==t?this.flagFrame:this.defaultFrame,c.InstanceMgr.AudioMgr.playFlag()},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){},e.prototype.open=function(t){this.isFlag||(this.isOpen=!0,this.blockType==r.BlockType.MINE?(this.sprite.spriteFrame=this.mines[1],t&&(c.InstanceMgr.AudioMgr.playBomb(),cc.director.emit("game_over",!1))):this.blockType==r.BlockType.NUMBER&&(this.sprite.spriteFrame=this.nums[this._number],t&&(0==this._number?(cc.director.emit("empty_click",this),c.InstanceMgr.AudioMgr.playMoreOpen()):c.InstanceMgr.AudioMgr.playSingleOpen())))},e.prototype.onClicking=function(){this.sprite.spriteFrame=this.nums[0]},e.prototype.showDefault=function(){this.sprite.spriteFrame=this.defaultFrame},e.prototype.playTintEffect=function(){cc.tween(this.node).to(0,{color:cc.color(255,255,255)}).to(.2,{color:cc.color(200,0,0)}).to(.2,{color:cc.color(255,255,255)}).start()},e.prototype.show=function(){this.blockType==r.BlockType.MINE?!this.isOpen&&(this.sprite.spriteFrame=this.mines[0]):this.blockType==r.BlockType.NUMBER&&(this.sprite.spriteFrame=this.nums[this._number])},i([a(cc.Sprite)],e.prototype,"sprite",void 0),i([a({type:cc.SpriteFrame,tooltip:"\u9ed8\u8ba4\u7684\u672a\u5f00\u542f\u56fe\u7247"})],e.prototype,"defaultFrame",void 0),i([a([cc.SpriteFrame])],e.prototype,"nums",void 0),i([a([cc.SpriteFrame])],e.prototype,"mines",void 0),i([a({type:cc.SpriteFrame,tooltip:"\u65d7\u5b50\u6807\u8bb0"})],e.prototype,"flagFrame",void 0),i([a({type:cc.Enum(r.BlockType)})],e.prototype,"blockType",void 0),i([a(cc.Vec2)],e.prototype,"pos",void 0),e=i([p],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./EnumDefine":"EnumDefine","./InstanceMgr":"InstanceMgr"}],Board:[function(t,e,o){"use strict";cc._RF.push(e,"e8e6810QZ1HQrwYzCv+xR/T","Board");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var r=t("./Block"),c=t("./Border"),s=t("./InstanceMgr"),p=t("./EnumDefine"),a=t("./NodeUtil"),u=cc._decorator,l=u.ccclass,h=u.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boardSize=new cc.Vec2(10,10),e.blockWidth=40,e.mineCount=15,e.blockPrefab=null,e.borderPrefab=null,e._boardData=[],e._isCountTime=!1,e._countTime=0,e._touchPosition=null,e._comboNum=0,e._preOpenTime=0,e}return n(e,t),e.prototype.onLoad=function(){cc.director.on("game_over",function(){this.offTouchEvent(),this.endShow(),this._comboNum=0},this),cc.director.on("restart",function(){this.reset()},this),cc.director.on("empty_click",function(t){this.calcForEmptyNumber(t)},this),this.create()},e.prototype.update=function(t){if(this._isCountTime&&(this._countTime+=t,this._countTime>.6&&(this._isCountTime=!1,this._touchPosition)))for(var e=this._boardData.length-1;e>=0;e--){var o=this._boardData[e];if(!o.isOpen&&o.node.getBoundingBoxToWorld().contains(this._touchPosition)){o.isFlag=!o.isFlag;break}}},e.prototype.create=function(){this.initBoard(),this.initBorder(),this.createMine(),this.calcMineForNumber(),this.initTouchEvent()},e.prototype.reset=function(){a.MyNodeUtil.removeAllChildren(this.node),this._boardData=[],this.create()},e.prototype.initBoard=function(){for(var t=this.getBlockStartPosition(),e=0;e<this.boardSize.x;e++)for(var o=0;o<this.boardSize.y;o++){var n=cc.instantiate(this.blockPrefab);n.x=t.x+this.blockWidth/2+e*this.blockWidth,n.y=t.y+this.blockWidth/2+o*this.blockWidth,n.width=n.height=this.blockWidth,n.parent=this.node;var i=n.getComponent(r.default);i.pos=cc.v2(e,o),this._boardData.push(i)}},e.prototype.getBlockStartPosition=function(){var t=-1*(this.boardSize.x*this.blockWidth)/2,e=-1*(this.boardSize.y*this.blockWidth)/2;return cc.v2(t,e)},e.prototype.initBorder=function(){var t=this.boardSize.x*this.blockWidth,e=this.boardSize.y*this.blockWidth,o=cc.instantiate(this.borderPrefab);o.x=o.y=0,o.parent=this.node,o.getComponent(c.default).size=new cc.Size(t,e)},e.prototype.createMine=function(){for(var t=this,e=0,o=[];e<this.mineCount;){var n=Math.floor(Math.random()*this.boardSize.x*this.boardSize.y),i=o.length,r=!1;if(i)for(var c=0;c<i;c++)if(n==o[c]){r=!0;break}r||(o.push(n),e++)}o.map(function(e){t._boardData[e].blockType=p.BlockType.MINE})},e.prototype.calcMineForNumber=function(){var t=this;this._boardData.map(function(e){if(!e.isMine){var o=0;t.requestPos(e.pos).map(function(e){t._boardData[e.x*t.boardSize.y+e.y].isMine&&o++}),e.number=o}})},e.prototype.calcForEmptyNumber=function(t){var e=this;this.requestPos(t.pos).map(function(t){var o=e._boardData[t.x*e.boardSize.y+t.y];o.isOpen||(!o.isMine&&o.open(!1),o.isEmpty&&!o.isFlag&&e.calcForEmptyNumber(o))})},e.prototype.requestPos=function(t){var e=t.x,o=t.y,n=this.boardSize.x,i=this.boardSize.y;return[cc.v2(e-1,o-1),cc.v2(e,o-1),cc.v2(e+1,o-1),cc.v2(e-1,o),cc.v2(e+1,o),cc.v2(e-1,o+1),cc.v2(e,o+1),cc.v2(e+1,o+1)].filter(function(t){return!(t.x<0||t.y<0||t.x>=n||t.y>=i)})},e.prototype.offTouchEvent=function(){this.node.targetOff(this)},e.prototype.initTouchEvent=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},e.prototype.onTouchStart=function(t){cc.log("Board->onTouchStart"),this._isCountTime=!0,this._countTime=0,this._touchPosition=t.getLocation()},e.prototype.onTouchMove=function(t){cc.log("Board->onTouchMove");var e=t.getStartLocation(),o=t.getLocation();e.sub(o).mag()>5&&(this._isCountTime=!1,this._countTime=0)},e.prototype.onTouchEnd=function(t){cc.log("Board->onTouchEnd");for(var e=t.getStartLocation(),o=this._boardData.length-1;o>=0;o--){var n=this._boardData[o];if(n.node.getBoundingBoxToWorld().contains(e)){n.isOpen?this.clickOpenBlock(n):this._countTime>.6||n.isFlag||(n.open(!0),!n.isMine&&this.calcCombo()),this.endCalc();break}}this._isCountTime=!1,this._countTime=0},e.prototype.onTouchCancel=function(t){cc.log("Board->onTouchCancel"),this._isCountTime=!1,this._countTime=0},e.prototype.clickOpenBlock=function(t){if(0!=t.number){for(var e=this.requestPos(t.pos),o=[],n=0,i=0;i<e.length;i++){var r=e[i],c=this._boardData[r.x*this.boardSize.y+r.y];c.isOpen||(o.push(c),c.isFlag&&n++)}if(n==t.number){var p=!1;for(i=0;i<o.length;i++){(a=o[i]).isFlag||(a.open(!1),a.isMine&&(p=!0))}1==o.length?s.InstanceMgr.AudioMgr.playSingleOpen():s.InstanceMgr.AudioMgr.playMoreOpen(),p?(s.InstanceMgr.AudioMgr.playBomb(),cc.director.emit("add_score",100),cc.director.emit("game_over",!1)):this.calcCombo()}else for(i=0;i<o.length;i++){var a;(a=o[i]).isFlag||a.playTintEffect()}}},e.prototype.calcCombo=function(){var t=(new Date).getTime();t-this._preOpenTime<3e3?(this._comboNum+=1,cc.director.emit("combo",this._comboNum),this._comboNum<=1?cc.director.emit("add_score",10):cc.director.emit("add_score",10*this._comboNum)):(this._comboNum=0,cc.director.emit("add_score",10)),this._preOpenTime=t},e.prototype.endCalc=function(){for(var t=0,e=0,o=0;o<this._boardData.length;o++){var n=this._boardData[o];!n.isOpen&&n.isFlag&&t++,n.isOpen&&e++}t==this.mineCount&&e==this._boardData.length-this.mineCount&&(cc.director.emit("add_score",100*this.mineCount),cc.director.emit("game_over",!0))},e.prototype.endShow=function(){this._boardData.map(function(t){t.show()})},i([h({tooltip:"\u68cb\u76d8\u683c\u5b50\u6a2a\u7eb5\u65b9\u5411\u683c\u5b50\u6570\u76ee"})],e.prototype,"boardSize",void 0),i([h({tooltip:"\u68cb\u5b50\u8fb9\u957f"})],e.prototype,"blockWidth",void 0),i([h({tooltip:"\u96f7\u7684\u4e2a\u6570"})],e.prototype,"mineCount",void 0),i([h(cc.Prefab)],e.prototype,"blockPrefab",void 0),i([h({type:cc.Prefab,tooltip:"\u8fb9\u6846\u9884\u5236\u4f53"})],e.prototype,"borderPrefab",void 0),e=i([l],e)}(cc.Component);o.default=f,cc._RF.pop()},{"./Block":"Block","./Border":"Border","./EnumDefine":"EnumDefine","./InstanceMgr":"InstanceMgr","./NodeUtil":"NodeUtil"}],Border:[function(t,e,o){"use strict";cc._RF.push(e,"948b2xX1pNBV7vtcK+QCvlg","Border");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,c=r.ccclass,s=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._size=new cc.Size(0,0),e}return n(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(t){this._size=t,this.node.width=t.width+48,this.node.height=t.height+44},enumerable:!0,configurable:!0}),i([s(cc.Size)],e.prototype,"_size",void 0),e=i([c],e)}(cc.Component);o.default=p,cc._RF.pop()},{}],EnumDefine:[function(t,e,o){"use strict";cc._RF.push(e,"e5dc33VQ8tGE7pQI0iRb9rp","EnumDefine"),Object.defineProperty(o,"__esModule",{value:!0}),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.NUMBER=1]="NUMBER",t[t.MINE=2]="MINE"}(o.BlockType||(o.BlockType={})),cc._RF.pop()},{}],InstanceMgr:[function(t,e,o){"use strict";cc._RF.push(e,"74c7eIPKglFnplrFbR9xlsc","InstanceMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.registerInstance=function(e,o){null!=t[e]?cc.error(e,"is duplicate"):t[e]=o},t}();o.InstanceMgr=n,cc._RF.pop()},{}],MainScene:[function(t,e,o){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","MainScene");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,c=r.ccclass,s=r.property,p=t("./InstanceMgr"),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gameOver=null,e.combo=null,e.score=null,e}return n(e,t),e.prototype.onLoad=function(){cc.director.on("game_over",function(t){this.gameOver.active=!0,this.gameOver.getComponentInChildren(cc.Label).string=t?"\u80dc\u5229":"\u5931\u8d25",t||cc.director.emit("add_score",100)},this),cc.director.on("combo",function(t){var e=cc.instantiate(this.combo.node);e.active=!0,e.getComponent(cc.Label).string="Combo x"+t,e.scale=.3,e.opacity=80,e.parent=this.node,p.InstanceMgr.AudioMgr.playCombo(t),cc.tween(e).to(.5,{scale:1,opacity:255,position:cc.v2(0,e.y+30)}).to(.5,{scale:.2,opacity:0,position:cc.v2(0,e.y+30)}).call(function(){cc.isValid(e)&&e.destroy()}).start()},this),cc.director.on("add_score",function(t){this.score.string=parseInt(this.score.string)+t},this),cc.director.on("restart",function(){this.score.string="0"},this)},e.prototype.start=function(){},e.prototype.restart=function(){this.gameOver.active=!1,cc.director.emit("restart")},i([s(cc.Node)],e.prototype,"gameOver",void 0),i([s(cc.Label)],e.prototype,"combo",void 0),i([s(cc.Label)],e.prototype,"score",void 0),e=i([c],e)}(cc.Component);o.default=a,cc._RF.pop()},{"./InstanceMgr":"InstanceMgr"}],NodeUtil:[function(t,e,o){"use strict";cc._RF.push(e,"dfb16aS5B5PTbt24YySdRaK","NodeUtil"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.removeAllChildren=function(t,e){void 0===e&&(e=!0);var o=t.children;void 0===e&&(e=!0);for(var n=o.length-1;n>=0;n--){var i=o[n];i&&(e&&i.cleanup(),i.parent=null,i.destroy())}t.children.length=0},t}();o.MyNodeUtil=new n,cc._RF.pop()},{}],"use_v2.1-2.2.1_cc.Toggle_event":[function(t,e,o){"use strict";cc._RF.push(e,"94a76st5QJOhaxXaoffHwbM","use_v2.1-2.2.1_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_isChecked=!0),cc._RF.pop()},{}]},{},["AudioMgr","Block","Board","Border","EnumDefine","InstanceMgr","MainScene","NodeUtil","use_v2.1-2.2.1_cc.Toggle_event"]);